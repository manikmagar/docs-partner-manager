= Create a Map For XML or JSON to Outbound EDI EDIFACT

Create a new Mule project in Anypoint Studio to import a template to map application messages from canonical formats such as XML or JSON, to outbound EDI EDIFACT messages to send to your trading partners.

== Create a New Project From a Template

Create a template project in Anypoint Studio and import a DataWeave map template that maps outbound EDI EDIFACT transactions to an application format:

. Launch Anypoint Studio.
. From the Anypoint Studio *File* menu, select *New > Project from Template*.
. Log in to Anypoint Exchange with your Anypoint Platform credentials.
. Search for `edifact`.
. Click `Template to create inbound and outbound EDIFACT message transformation`.
. Click *Open* to create a new project in your Studio workspace that is preloaded with the template.

You can also download the template to map outbound EDI EDIFACT transactions to the application format https://anypoint.mulesoft.com/exchange/org.mule.examples/template-b2b-edi-outbound-EDIFACT-map[from Exchange].

Open the Mule configuration `file02-outbound-edifact-transform` to create the outbound EDIFACT message transformation.

== Set the Source Message Type

Set the source message type to define the metadata structure of your application message, such as XML or JSON:

. Copy the schema file of your target application message type into the `<Project-name>/src/main/resources` folder in the template project.
. From the *Mule Palette* view, click *Transform Message* and drag it on to the Studio canvas.
. Select the *Transform Message* component and in the input section, next to *Payload*, click *Define metadata*:
+
image::partner-manager-outbound-map-1.png[Transform Message component add payload metadata]
+
. Click *Add*.
. In *Type id*, enter a new message type ID, for example, `outbound-po-ack`.
. Click *Create type*.
. In the *Select metadata type* dialog window, from the *Type* drop-down menu, select *JSON* or *XML*.
. Browse to the location of the JSON or XML schema file you imported in step 1 and click *Select*.

== Set the Target EDIFACT Message Type

The template `02-outbound-edifact-transform.xml` is configured with the EDIFACT version D97A, ORDRSP message type. Follow these steps to change the target EDIFACT message type:

. Click the *Global Elements* tab at the base of the Studio canvas in `00-global-configs.xml`.
. From *Global Configuration Elements*, EDIFACT_Write and click *Edit*.
. In *Name*, change the name of the configuration.
. In Schema definitions select the value `/edifact/d97a/ORDRSP.esl` and click the edit icon.
. Change the schema value to the version and transaction set you want to map to.
+
For example, set *Value* to /edifact/d96a/INVOIC.esl`, to map to a `D96A Invoice` message.

=== JSON/XML to EDI EDIFACT mapping

The new EDIFACT message structure displays in the output pane on the right, and your application message structure (JSON or XML) displays in the input pane on the left:

image

To create the mapping:

. Click the edit current target icon on top of the right side pane:
+
image
+
Select *File*, and save the DataWeave map with a meaningful name, such as: `OTB-Canonical-Purchase-Order-Ack-JSON-to-EDIFACT-D97A-ORDRSP.dwl`:
+
image

== Test the Map Locally

Follow these steps to test the map locally in Anypoint Studio:

. In *Package Explorer*, right-click on the project, and click *Run > Run as Mule application*.
. Use a REST client to post a JSON or an XML payload to the URL `+http://localhost:8081/edifact/outbound.+`.
+
The application returns the translated EDI EDIFACT transaction.
+
. After you verify that the map works correctly, copy the DataWeave (dwl) file, and import it to the Map section of your outbound EDIFACT message flow.

== See Also

* xref:https://anypoint.mulesoft.com/exchange/org.mule.examples/b2b-demo-EDIFACT-transform/[Transform XML to Outbound EDI EDIFACT 850 Purchase Orders Example Project on Exchange]
* xref:create-outbound-message-flow.adoc[Create and Configure an Outbound Message Flow]
